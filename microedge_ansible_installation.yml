---
- hosts: microedge-vm
  become: yes
  tasks:
    - name: Install Node.js and Edge Microgateway via shell commands
      ansible.builtin.shell: |
        sudo apt-get update
        sudo apt-get install -y curl
        curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
        sudo apt-get install -y nodejs
        sudo npm install -g edgemicro
        sudo /usr/bin/edgemicro init
      args:
        executable: /bin/bash
      
    - name: Verify Node.js and npm installation
      ansible.builtin.command: npm -v
      register: npm_version
      failed_when: npm_version.rc != 0
      
    - name: Show npm version
      ansible.builtin.debug:
        var: npm_version.stdout